---
# file: oracle-java/tests/test.yml

- name: setup python2
  hosts: "{{ vagrant_box }}"
  gather_facts: no

  tasks:
    - raw: sudo apt-get update -qq && sudo apt-get install -qq python2.7
      when: playbook_python2 is defined and
            playbook_python2

- name: setup stretch
  hosts: "{{ vagrant_box }}"

  tasks:
    - apt:
        name=software-properties-common
        state=present
        become=yes
      when: ansible_distribution | lower == 'stretch'

- name: tests play
  hosts: all
  gather_facts: yes
  vars:
    debug: yes
    test_redhat_java_version: '10.0.2'
    test_debian_java_version: '10.0.2'

  roles:
    - role: oracle-java
      oracle_java_dir_source: '/usr/local/src'
      oracle_java_download_timeout: 60
      oracle_java_rpm_filename: 'jdk-10.0.2_linux-x64_bin.rpm'
      oracle_java_home: '/usr/java/default'
      oracle_java_os_supported: yes
      oracle_java_rpm_url: 'http://download.oracle.com/otn-pub/java/jdk/10.0.2+13/19aef61b38124481863b1413dce1855f/jdk-10.0.2_linux-x64_bin.rpm'
      oracle_java_rpm_validate_certs: yes
      oracle_java_set_as_default: yes
      oracle_java_version_string: 10.0.2
      when: ansible_os_family | lower == 'redhat'

    - role: tests
      expected_java_version: "{{ test_redhat_java_version }}"
      tags: [ test ]
      when: ansible_os_family | lower == 'redhat'

    - role: oracle-java
      oracle_java_apt_repository: "ppa:linuxuprising/java"
      oracle_java_cache_valid_time: 3600
      oracle_java_deb_package: 'oracle-java10-installer'
      oracle_java_debconf_package_default: 'oracle-java10-set-default'
      oracle_java_home: "/usr/lib/jvm/java-10-oracle"
      oracle_java_state: latest
      when: ansible_os_family | lower == 'debian'

    - role: tests
      expected_java_version: "{{ test_debian_java_version }}"
      tags: [ test ]
      when: ansible_os_family | lower == 'debian'
